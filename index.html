<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Phaser ‚Äì Bot Interaction (SPACE to talk)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.0/dist/phaser.js"></script>
  <style>html,body{margin:0;background:#0b0f14}</style>
</head>
<body>
<script>
const config = {
  type: Phaser.AUTO,
  width: 960,
  height: 540,
  backgroundColor: '#0b0f14',
  physics: {
    default: 'arcade',
    arcade: { gravity: { y: 900 }, debug: false }
  },
  scene: { preload, create, update }
};
new Phaser.Game(config);

let player, bot, platforms;
let cursors, spaceKey, escKey;
let canMove = true;
let dialogOpen = false;
let nearPrompt;     // ‚ÄúSPACE to talk‚Äù hint
let dialogGroup;    // container for dialog UI
let patrol = { minX: 520, maxX: 820, speed: 60, paused: false };

function preload(){
  // Build simple textures with Graphics so there are no external files.

  // Player texture (green)
  const g1 = this.add.graphics();
  g1.fillStyle(0x3ad97a,1).fillRoundedRect(0,0,24,36,6);
  g1.lineStyle(2,0x1b6138,1).strokeRoundedRect(0,0,24,36,6);
  g1.generateTexture('playerTex',24,36); g1.destroy();

  // Bot texture (blue)
  const g2 = this.add.graphics();
  g2.fillStyle(0x3aa1ff,1).fillRoundedRect(0,0,24,36,6);
  g2.lineStyle(2,0x124a84,1).strokeRoundedRect(0,0,24,36,6);
  g2.generateTexture('botTex',24,36); g2.destroy();

  // Platform tile
  const g3 = this.add.graphics();
  g3.fillStyle(0x4b5c6b,1).fillRect(0,0,64,20);
  g3.lineStyle(2,0x2c3640,1).strokeRect(0,0,64,20);
  g3.generateTexture('tile',64,20); g3.destroy();
}

function create(){
  const W = this.scale.width, H = this.scale.height;

  // Static platforms
  platforms = this.physics.add.staticGroup();
  // Ground (span across)
  for(let x=0;x<W;x+=64){ platforms.create(x+32,H-20,'tile').refreshBody(); }
  // A ledge where the bot patrols
  for(let x=520;x<=840;x+=64){ platforms.create(x+32, H-160, 'tile').refreshBody(); }
  // Small ledge for fun
  for(let x=200;x<=328;x+=64){ platforms.create(x+32, H-260,'tile').refreshBody(); }

  // Player
  player = this.physics.add.sprite(120, H-100, 'playerTex');
  player.setCollideWorldBounds(true).setBounce(0).setDragX(1200);
  player.body.setSize(20,34).setOffset(2,2);

  // Bot (patrols on the upper ledge)
  bot = this.physics.add.sprite(680, H-200, 'botTex');
  bot.setCollideWorldBounds(true).setBounce(0);
  bot.body.setSize(20,34).setOffset(2,2);
  bot.setVelocityX(patrol.speed);

  // Collisions with platforms
  this.physics.add.collider(player, platforms);
  this.physics.add.collider(bot, platforms);

  cursors = this.input.keyboard.createCursorKeys();
  this.aKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A);
  this.dKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D);
  this.wKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W);
  this.left = () => (cursors.left.isDown || this.aKey.isDown);
  this.right = () => (cursors.right.isDown || this.dKey.isDown);
  this.jump = () => (cursors.up.isDown || this.wKey.isDown);

  spaceKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);
  escKey   = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ESC);

  // ‚ÄúSPACE to talk‚Äù hint (hidden by default)
  nearPrompt = this.add.text(0,0,'SPACE to talk',{
    fontFamily:'Arial', fontSize:'16px', color:'#fff',
    backgroundColor:'#1a2733', padding:{left:8,right:8,top:4,bottom:4}
  }).setAlpha(0).setDepth(1000);

  // Dialog UI container (hidden initially)
  dialogGroup = this.add.container(W/2, 130).setDepth(1500).setVisible(false);
  const panel = this.add.rectangle(0,0, 420, 130, 0x0f1822, 0.95)
                  .setStrokeStyle(2, 0x3aa1ff, 1).setOrigin(0.5);
  const txt1  = this.add.text(0,-26, 'ü§ñ Bot: What do you want?', {
                  fontFamily:'Arial', fontSize:'20px', color:'#ffffff'
                }).setOrigin(0.5);
  const txt2  = this.add.text(0,12, 'SPACE: Continue   ‚Ä¢   ESC: Cancel', {
                  fontFamily:'Arial', fontSize:'16px', color:'#b7c9d3'
                }).setOrigin(0.5);
  dialogGroup.add([panel, txt1, txt2]);

  // Open/close dialog handlers
  spaceKey.on('down', () => {
    if (isCloseToBot() && !dialogOpen) openDialog.call(this);
    else if (dialogOpen) closeDialog.call(this);
  });
  escKey.on('down', () => { if (dialogOpen) closeDialog.call(this); });

  // Simple camera follow (optional)
  this.cameras.main.startFollow(player, true, 0.1, 0.1);
  this.cameras.main.setBounds(0,0,W,H);
}

function update(time, delta){
  // Player controls (disabled during dialog)
  if (canMove){
    const speed = 210;
    if (this.left())  player.setVelocityX(-speed);
    else if (this.right()) player.setVelocityX(speed);
    else player.setVelocityX(0);

    // Jump only when on floor
    if (this.jump() && player.body.blocked.down) player.setVelocityY(-420);
  } else {
    // Freeze player during dialog
    player.setVelocityX(0);
  }

  // Bot patrol (when not paused by dialog)
  if (!patrol.paused){
    // Flip direction at patrol edges
    if (bot.x <= patrol.minX) { bot.setVelocityX(+patrol.speed); bot.setFlipX(false); }
    if (bot.x >= patrol.maxX) { bot.setVelocityX(-patrol.speed); bot.setFlipX(true);  }
  } else {
    bot.setVelocityX(0);
  }

  // Show/hide ‚ÄúSPACE to talk‚Äù hint if player is close
  if (!dialogOpen && isCloseToBot()){
    nearPrompt.setPosition(bot.x, bot.y - 48).setAlpha(0.95);
  } else {
    nearPrompt.setAlpha(0);
  }
}

/* ---------- Helpers ---------- */

function isCloseToBot(){
  // Close if horizontally near and vertically overlapping-ish
  const dx = Math.abs(player.x - bot.x);
  const dy = Math.abs(player.y - bot.y);
  return dx < 40 && dy < 50; // tweak range if needed
}

function openDialog(){
  // Pause movement for both
  canMove = false;
  patrol.paused = true;
  bot.setVelocityX(0);

  dialogOpen = true;
  dialogGroup.setVisible(true);
  // Small pop animation
  this.tweens.add({ targets: dialogGroup, scale: { from:0.9, to:1 }, alpha:{from:0, to:1}, duration:120 });
}

function closeDialog(){
  dialogOpen = false;
  dialogGroup.setVisible(false);
  canMove = true;
  patrol.paused = false; // bot resumes patrolling
}

/* (Optional) You could extend this:
   - Replace dialog text with choices (‚ÄúTrade‚Äù, ‚ÄúQuest‚Äù, ‚ÄúBye‚Äù).
   - On SPACE while dialogOpen, cycle options or act on a selected one.
   - Use a Phaser DOMElement or bitmap text for more UI polish. */
</script>
</body>
</html>
